#!/usr/bin/env node
import H from"path";import{execa as Pt}from"execa";import oe from"fs-extra";import*as u from"@clack/prompts";import V from"chalk";import{Command as pt}from"commander";import re from"path";import{fileURLToPath as Ze}from"url";var et=Ze(import.meta.url),tt=re.dirname(et),p=re.join(tt,"../"),le=`   ___ ___ ___   __ _____ ___   _____ ____    __   ___ ___
  / __| _ \\ __| /  \\_   _| __| |_   _|__ /   /  \\ | _ \\ _ \\
 | (__|   / _| / /\\ \\| | | _|    | |  |_ \\  / /\\ \\|  _/  _/
  \\___|_|_\\___|_/\u203E\u203E\\_\\_| |___|   |_| |___/ /_/\u203E\u203E\\_\\_| |_|
`,N="my-t3-app",X="create-t3-app";import F from"path";import $ from"fs-extra";var pe=({projectDir:e,packages:t,databaseProvider:a,projectName:s})=>{let i=t?.nextAuth.inUse,n=t?.prisma.inUse,o=t?.drizzle.inUse,r=n||o,m=st(!!i,!!n,!!o,a,s),c="";if(i&&r?c="with-auth-db.js":i?c="with-auth.js":r&&(c="with-db.js"),c!==""){let g=F.join(p,"template/extras/src/env",c),y=$.readFileSync(g,"utf-8"),P=F.join(e,"src/env.js");$.writeFileSync(P,a==="sqlite"?y.replace(`
      .url()`,""):y,"utf-8")}let f=F.join(e,".env"),w=F.join(e,".env.example");$.writeFileSync(f,m,"utf-8"),$.writeFileSync(w,nt+m,"utf-8")},st=(e,t,a,s,i)=>{let n=`
# When adding additional environment variables, the schema in "/src/env.js"
# should be updated accordingly.
`.trim().concat(`
`);return t&&(n+=`
# Prisma
# https://www.prisma.io/docs/reference/database-reference/connection-urls#env
`),a&&(n+=`
# Drizzle
`),(t||a)&&(s==="planetscale"?a?n+=`Get the Database URL from the "prisma" dropdown selector in PlanetScale. 
# Change the query params at the end of the URL to "?ssl={"rejectUnauthorized":true}"
DATABASE_URL='mysql://YOUR_MYSQL_URL_HERE?ssl={"rejectUnauthorized":true}'`:n=`Get the Database URL from the "prisma" dropdown selector in PlanetScale. 
DATABASE_URL='mysql://YOUR_MYSQL_URL_HERE?sslaccept=strict'`:s==="mysql"?n+=`DATABASE_URL="mysql://root:password@localhost:3306/${i}"`:s==="postgres"?n+=`DATABASE_URL="postgresql://postgres:password@localhost:5432/${i}"`:s==="sqlite"&&(n+=t?'DATABASE_URL="file:./db.sqlite"':'DATABASE_URL="db.sqlite"'),n+=`
`),e&&(n+=`
# Next Auth
# You can generate a new secret on the command line with:
# openssl rand -base64 32
# https://next-auth.js.org/configuration/options#secret
# NEXTAUTH_SECRET=""
NEXTAUTH_URL="http://localhost:3000"

# Next Auth Discord Provider
DISCORD_CLIENT_ID=""
DISCORD_CLIENT_SECRET=""
`),!e&&!t&&(n+=`
# Example:
# SERVERVAR="foo"
# NEXT_PUBLIC_CLIENTVAR="bar"
`),n},nt=`
# Since the ".env" file is gitignored, you can use the ".env.example" file to
# build a new ".env" file when you clone the repo. Keep this file up-to-date
# when you add new variables to \`.env\`.

# This file will be committed to version control, so make sure not to have any
# secrets in it. If you are cloning this repo, create a copy of this file named
# ".env" and populate it with your secrets.
`.trim().concat(`

`);import R from"path";import fe from"fs-extra";import me from"path";import de from"fs-extra";import it from"sort-package-json";var ce={"next-auth":"^4.24.5","@next-auth/prisma-adapter":"^1.0.7","@auth/drizzle-adapter":"^0.3.6",prisma:"^5.6.0","@prisma/client":"^5.6.0","@prisma/adapter-planetscale":"^5.6.0","drizzle-orm":"^0.29.3","drizzle-kit":"^0.20.9",mysql2:"^3.6.1","@planetscale/database":"^1.11.0",postgres:"^3.4.3","@types/better-sqlite3":"^7.6.6","better-sqlite3":"^9.0.0",tailwindcss:"^3.3.5",autoprefixer:"^10.4.14",postcss:"^8.4.31",prettier:"^3.1.0","prettier-plugin-tailwindcss":"^0.5.7","@trpc/client":"^10.43.6","@trpc/server":"^10.43.6","@trpc/react-query":"^10.43.6","@trpc/next":"^10.43.6","@tanstack/react-query":"^4.36.1",superjson:"^2.2.1","server-only":"^0.0.1"};var h=e=>{let{dependencies:t,devMode:a,projectDir:s}=e,i=de.readJSONSync(me.join(s,"package.json"));t.forEach(o=>{let r=ce[o];a&&i.devDependencies?i.devDependencies[o]=r:i.dependencies&&(i.dependencies[o]=r)});let n=it(i);de.writeJSONSync(me.join(s,"package.json"),n,{spaces:2})};var ue=({projectDir:e,packages:t,appRouter:a})=>{let s=t?.prisma.inUse,i=t?.drizzle.inUse,n=["next-auth"];s&&n.push("@next-auth/prisma-adapter"),i&&n.push("@auth/drizzle-adapter"),h({projectDir:e,dependencies:n,devMode:!1});let o=R.join(p,"template/extras"),c=a?"src/app/api/auth/[...nextauth]/route.ts":"src/pages/api/auth/[...nextauth].ts",f=R.join(o,c),w=R.join(e,c),g=R.join(o,"src/server",a?"auth-app":"auth-pages",s?"with-prisma.ts":i?"with-drizzle.ts":"base.ts"),y=R.join(e,"src/server/auth.ts");fe.copySync(f,w),fe.copySync(g,y)};import A from"path";import j from"fs-extra";var ge=({projectDir:e,packages:t,databaseProvider:a})=>{h({projectDir:e,dependencies:["prisma"],devMode:!0}),h({projectDir:e,dependencies:["@prisma/client"],devMode:!1}),a==="planetscale"&&h({projectDir:e,dependencies:["@prisma/adapter-planetscale","@planetscale/database"],devMode:!1});let s=A.join(p,"template/extras"),i=A.join(s,"prisma/schema",`${t?.nextAuth.inUse?"with-auth":"base"}${a==="planetscale"?"-planetscale":""}.prisma`),n=j.readFileSync(i,"utf-8");a!=="sqlite"&&(n=n.replace('provider = "sqlite"',`provider = "${{mysql:"mysql",postgres:"postgresql",planetscale:"mysql"}[a]}"`),["mysql","planetscale"].includes(a)&&(n=n.replace("// @db.Text","@db.Text")));let o=A.join(e,"prisma/schema.prisma");j.mkdirSync(A.dirname(o),{recursive:!0}),j.writeFileSync(o,n);let r=A.join(s,a==="planetscale"?"src/server/db/db-prisma-planetscale.ts":"src/server/db/db-prisma.ts"),m=A.join(e,"src/server/db.ts"),c=A.join(e,"package.json"),f=j.readJSONSync(c);f.scripts={...f.scripts,postinstall:"prisma generate","db:push":"prisma db push","db:studio":"prisma studio"},j.copySync(r,m),j.writeJSONSync(c,f,{spaces:2})};import v from"path";import q from"fs-extra";var he=({projectDir:e})=>{h({projectDir:e,dependencies:["tailwindcss","postcss","autoprefixer","prettier","prettier-plugin-tailwindcss"],devMode:!0});let t=v.join(p,"template/extras"),a=v.join(t,"config/tailwind.config.ts"),s=v.join(e,"tailwind.config.ts"),i=v.join(t,"config/postcss.config.cjs"),n=v.join(e,"postcss.config.cjs"),o=v.join(t,"config/_prettier.config.js"),r=v.join(e,"prettier.config.js"),m=v.join(t,"src/styles/globals.css"),c=v.join(e,"src/styles/globals.css");q.copySync(a,s),q.copySync(i,n),q.copySync(m,c),q.copySync(o,r)};import d from"path";import at from"fs-extra";var ye=({projectDir:e,packages:t,appRouter:a})=>{h({projectDir:e,dependencies:["@tanstack/react-query","superjson","@trpc/server","@trpc/client","@trpc/next","@trpc/react-query"],devMode:!1});let s=t?.nextAuth.inUse,i=t?.prisma.inUse,n=t?.drizzle.inUse,o=i||n,r=d.join(p,"template/extras"),f=a?"src/app/api/trpc/[trpc]/route.ts":"src/pages/api/trpc/[trpc].ts",w=d.join(r,f),g=d.join(e,f),y=s&&o?"with-auth-db.ts":s?"with-auth.ts":o?"with-db.ts":"base.ts",P=d.join(r,"src/server/api",a?"trpc-app":"trpc-pages",y),C=d.join(e,"src/server/api/trpc.ts"),He=d.join(r,"src/server/api/root.ts"),Ke=d.join(e,"src/server/api/root.ts"),Ye=s&&i?"with-auth-prisma.ts":s&&n?"with-auth-drizzle.ts":s?"with-auth.ts":i?"with-prisma.ts":n?"with-drizzle.ts":"base.ts",Xe=d.join(r,"src/server/api/routers/post",Ye),Qe=d.join(e,"src/server/api/routers/post.ts"),K=[[w,g],[P,C],[He,Ke],[Xe,Qe]];if(a){h({dependencies:["server-only"],devMode:!1,projectDir:e});let k=d.join(r,"src/trpc");K.push([d.join(k,"server.ts"),d.join(e,"src/trpc/server.ts")],[d.join(k,"react.tsx"),d.join(e,"src/trpc/react.tsx")],[d.join(k,"shared.ts"),d.join(e,"src/trpc/shared.ts")],[d.join(r,"src/app/_components",t?.tailwind.inUse?"create-post-tw.tsx":"create-post.tsx"),d.join(e,"src/app/_components/create-post.tsx")])}else{let k=d.join(r,"src/utils/api.ts"),Y=d.join(e,"src/utils/api.ts");K.push([k,Y])}K.forEach(([k,Y])=>{at.copySync(k,Y)})};import Q from"fs";import we from"path";var xe=({projectDir:e,databaseProvider:t,projectName:a})=>{let s=we.join(p,`template/extras/start-database/${t}.sh`),i=Q.readFileSync(s,"utf-8"),n=we.join(e,"start-database.sh");Q.writeFileSync(n,i.replaceAll("project1",a)),Q.chmodSync(n,"755")};import _ from"path";import S from"fs-extra";var be=({projectDir:e,packages:t,scopedAppName:a,databaseProvider:s})=>{let i=["drizzle-kit"];s==="planetscale"&&i.push("mysql2"),s==="sqlite"&&i.push("@types/better-sqlite3"),h({projectDir:e,dependencies:i,devMode:!0}),h({projectDir:e,dependencies:["drizzle-orm",{planetscale:"@planetscale/database",mysql:"mysql2",postgres:"postgres",sqlite:"better-sqlite3"}[s]],devMode:!1});let n=_.join(p,"template/extras"),o=_.join(n,`config/drizzle-config-${s==="planetscale"?"mysql":s}.ts`),r=_.join(e,"drizzle.config.ts"),m=_.join(n,"src/server/db/schema-drizzle",t?.nextAuth.inUse?`with-auth-${s}.ts`:`base-${s}.ts`),c=_.join(e,"src/server/db/schema.ts"),f=S.readFileSync(m,"utf-8");f=f.replace("project1_${name}",`${a}_\${name}`);let w=S.readFileSync(o,"utf-8");w=w.replace("project1_*",`${a}_*`);let g=_.join(n,`src/server/db/index-drizzle/with-${s}.ts`),y=_.join(e,"src/server/db/index.ts"),P=_.join(e,"package.json"),C=S.readJSONSync(P);C.scripts={...C.scripts,"db:push":`drizzle-kit push:${{postgres:"pg",sqlite:"sqlite",mysql:"mysql",planetscale:"mysql"}[s]}`,"db:studio":"drizzle-kit studio"},S.copySync(o,r),S.mkdirSync(_.dirname(c),{recursive:!0}),S.writeFileSync(c,f),S.writeFileSync(r,w),S.copySync(g,y),S.writeJSONSync(P,C,{spaces:2})};var ve=["mysql","postgres","sqlite","planetscale"],_e=(e,t)=>({nextAuth:{inUse:e.includes("nextAuth"),installer:ue},prisma:{inUse:e.includes("prisma"),installer:ge},drizzle:{inUse:e.includes("drizzle"),installer:be},tailwind:{inUse:e.includes("tailwind"),installer:he},trpc:{inUse:e.includes("trpc"),installer:ye},dbContainer:{inUse:["mysql","postgres"].includes(t),installer:xe},envVariables:{inUse:!0,installer:pe}});import ot from"path";import rt from"fs-extra";var T=()=>{let e=ot.join(p,"package.json");return rt.readJSONSync(e).version??"1.0.0"};var x=()=>{let e=process.env.npm_config_user_agent;return e?e.startsWith("yarn")?"yarn":e.startsWith("pnpm")?"pnpm":e.startsWith("bun")?"bun":"npm":"npm"};var D=class extends Error{constructor(t){super(t)}};import G from"chalk";var l={error(...e){console.log(G.red(...e))},warn(...e){console.log(G.yellow(...e))},info(...e){console.log(G.cyan(...e))},success(...e){console.log(G.green(...e))}};var L=e=>(e.length>1&&e.endsWith("/")&&(e=e.slice(0,-1)),e);var lt=/^(?:@[a-z0-9-*~][a-z0-9-*._~]*\/)?[a-z0-9-~][a-z0-9-._~]*$/,Se=e=>{let t=L(e),a=t.split("/"),s=a.findIndex(n=>n.startsWith("@")),i=a[a.length-1];if(a.findIndex(n=>n.startsWith("@"))!==-1&&(i=a.slice(s).join("/")),!(t==="."||lt.test(i??"")))return"App name must consist of only lowercase alphanumeric characters, '-', and '_'"};var Pe=e=>{if(e.startsWith(".")||e.startsWith("/"))return"Import alias can't start with '.' or '/'"};var I={appName:N,packages:["nextAuth","prisma","tailwind","trpc"],flags:{noGit:!1,noInstall:!1,default:!1,CI:!1,tailwind:!1,trpc:!1,prisma:!1,drizzle:!1,nextAuth:!1,importAlias:"~/",appRouter:!1},databaseProvider:"sqlite"},ke=async()=>{let e=I,t=new pt().name(X).description("A CLI for creating web applications with the t3 stack").argument("[dir]","The name of the application, as well as the name of the directory to create").option("--noGit","Explicitly tell the CLI to not initialize a new git repo in the project",!1).option("--noInstall","Explicitly tell the CLI to not run the package manager's install command",!1).option("-y, --default","Bypass the CLI and use all default options to bootstrap a new t3-app",!1).option("--CI","Boolean value if we're running in CI",!1).option("--tailwind [boolean]","Experimental: Boolean value if we should install Tailwind CSS. Must be used in conjunction with `--CI`.",s=>!!s&&s!=="false").option("--nextAuth [boolean]","Experimental: Boolean value if we should install NextAuth.js. Must be used in conjunction with `--CI`.",s=>!!s&&s!=="false").option("--prisma [boolean]","Experimental: Boolean value if we should install Prisma. Must be used in conjunction with `--CI`.",s=>!!s&&s!=="false").option("--drizzle [boolean]","Experimental: Boolean value if we should install Drizzle. Must be used in conjunction with `--CI`.",s=>!!s&&s!=="false").option("--trpc [boolean]","Experimental: Boolean value if we should install tRPC. Must be used in conjunction with `--CI`.",s=>!!s&&s!=="false").option("-i, --import-alias","Explicitly tell the CLI to use a custom import alias",I.flags.importAlias).option("--dbProvider [provider]",`Choose a database provider to use. Possible values: ${ve.join(", ")}`,I.flags.importAlias).option("--appRouter [boolean]","Explicitly tell the CLI to use the new Next.js app router",s=>!!s&&s!=="false").version(T(),"-v, --version","Display the version number").addHelpText("afterAll",`
 The t3 stack was inspired by ${V.hex("#E8DCFF").bold("@t3dotgg")} and has been used to build awesome fullstack applications like ${V.hex("#E24A8D").underline("https://ping.gg")} 
`).parse(process.argv);process.env.npm_config_user_agent?.startsWith("yarn/3")&&l.warn(`  WARNING: It looks like you are using Yarn 3. This is currently not supported,
  and likely to result in a crash. Please run create-t3-app with another
  package manager such as pnpm, npm, or Yarn Classic.
  See: https://github.com/t3-oss/create-t3-app/issues/57`);let a=t.args[0];if(a&&(e.appName=a),e.flags=t.opts(),e.flags.CI)return e.packages=[],e.flags.trpc&&e.packages.push("trpc"),e.flags.tailwind&&e.packages.push("tailwind"),e.flags.prisma&&e.packages.push("prisma"),e.flags.drizzle&&e.packages.push("drizzle"),e.flags.nextAuth&&e.packages.push("nextAuth"),e.flags.prisma&&e.flags.drizzle&&(l.warn("Incompatible combination Prisma + Drizzle. Exiting."),process.exit(0)),e.databaseProvider=e.packages.includes("drizzle")?"planetscale":"sqlite",e;if(e.flags.default)return e;try{if(process.env.TERM_PROGRAM?.toLowerCase().includes("mintty"))throw l.warn(`  WARNING: It looks like you are using MinTTY, which is non-interactive. This is most likely because you are 
  using Git Bash. If that's that case, please use Git Bash from another terminal, such as Windows Terminal. Alternatively, you 
  can provide the arguments from the CLI directly: https://create.t3.gg/en/installation#experimental-usage to skip the prompts.`),new D("Non-interactive environment");let s=x(),i=await u.group({...!a&&{name:()=>u.text({message:"What will your project be called?",defaultValue:a,validate:Se})},language:()=>u.select({message:"Will you be using TypeScript or JavaScript?",options:[{value:"typescript",label:"TypeScript"},{value:"javascript",label:"JavaScript"}],initialValue:"typescript"}),_:({results:o})=>o.language==="javascript"?u.note(V.redBright("Wrong answer, using TypeScript instead")):void 0,styling:()=>u.confirm({message:"Will you be using Tailwind CSS for styling?"}),trpc:()=>u.confirm({message:"Would you like to use tRPC?"}),authentication:()=>u.select({message:"What authentication provider would you like to use?",options:[{value:"none",label:"None"},{value:"next-auth",label:"NextAuth.js"}],initialValue:"none"}),database:()=>u.select({message:"What database ORM would you like to use?",options:[{value:"none",label:"None"},{value:"prisma",label:"Prisma"},{value:"drizzle",label:"Drizzle"}],initialValue:"none"}),appRouter:()=>u.confirm({message:V.bgCyan(" EXPERIMENTAL ")+" Would you like to use Next.js App Router?",initialValue:!1}),databaseProvider:({results:o})=>{if(o.database!=="none")return u.select({message:"What database provider would you like to use?",options:[{value:"sqlite",label:"SQLite"},{value:"mysql",label:"MySQL"},{value:"postgres",label:"PostgreSQL"},{value:"planetscale",label:"Planetscale"}],initialValue:"sqlite"})},...!e.flags.noGit&&{git:()=>u.confirm({message:"Should we initialize a Git repository and stage the changes?",initialValue:!I.flags.noGit})},...!e.flags.noInstall&&{install:()=>u.confirm({message:`Should we run '${s}`+(s==="yarn"?"'?":" install' for you?"),initialValue:!I.flags.noInstall})},importAlias:()=>u.text({message:"What import alias would you like to use?",defaultValue:I.flags.importAlias,placeholder:I.flags.importAlias,validate:Pe})},{onCancel(){process.exit(1)}}),n=[];return i.styling&&n.push("tailwind"),i.trpc&&n.push("trpc"),i.authentication==="next-auth"&&n.push("nextAuth"),i.database==="prisma"&&n.push("prisma"),i.database==="drizzle"&&n.push("drizzle"),{appName:i.name??e.appName,packages:n,databaseProvider:i.databaseProvider||"sqlite",flags:{...e.flags,appRouter:i.appRouter??e.flags.appRouter,noGit:!i.git||e.flags.noGit,noInstall:!i.install||e.flags.noInstall,importAlias:i.importAlias??e.flags.importAlias}}}catch(s){if(s instanceof D)l.warn(`
  ${X} needs an interactive terminal to provide options`),await u.confirm({message:"Continue scaffolding a default T3 app?",initialValue:!0})||(l.info("Exiting..."),process.exit(0)),l.info(`Bootstrapping a default T3 app in ./${e.appName}`);else throw s}return e};import De from"fs";import U from"path";import Ae from"chalk";import ct from"ora";var Ie=e=>{let{packages:t}=e;l.info("Adding boilerplate...");for(let[a,s]of Object.entries(t))if(s.inUse){let i=ct(`Boilerplating ${a}...`).start();s.installer(e),i.succeed(Ae.green(`Successfully setup boilerplate for ${Ae.green.bold(a)}`))}l.info("")};import Z from"path";import*as J from"@clack/prompts";import z from"chalk";import O from"fs-extra";import mt from"ora";var ze=async({projectName:e,projectDir:t,pkgManager:a,noInstall:s})=>{let i=Z.join(p,"template/base");s?l.info(""):l.info(`
Using: ${z.cyan.bold(a)}
`);let n=mt(`Scaffolding in: ${t}...
`).start();if(O.existsSync(t))if(O.readdirSync(t).length===0)e!=="."&&n.info(`${z.cyan.bold(e)} exists but is empty, continuing...
`);else{n.stopAndPersist();let r=await J.select({message:`${z.redBright.bold("Warning:")} ${z.cyan.bold(e)} already exists and isn't empty. How would you like to proceed?`,options:[{label:"Abort installation (recommended)",value:"abort"},{label:"Clear the directory and continue installation",value:"clear"},{label:"Continue installation and overwrite conflicting files",value:"overwrite"}],initialValue:"abort"});r==="abort"&&(n.fail("Aborting installation..."),process.exit(1)),await J.confirm({message:`Are you sure you want to ${r==="clear"?"clear the directory":"overwrite conflicting files"}?`,initialValue:!1})||(n.fail("Aborting installation..."),process.exit(1)),r==="clear"&&(n.info(`Emptying ${z.cyan.bold(e)} and creating t3 app..
`),O.emptyDirSync(t))}n.start(),O.copySync(i,t),O.renameSync(Z.join(t,"_gitignore"),Z.join(t,".gitignore"));let o=e==="."?"App":z.cyan.bold(e);n.succeed(`${o} ${z.green("scaffolded successfully!")}
`)};import b from"path";import W from"fs-extra";var je=({projectDir:e,packages:t})=>{let a=b.join(p,"template/extras/src/pages/_app"),s=t.trpc.inUse,i=t.nextAuth.inUse,n="base.tsx";i&&s?n="with-auth-trpc.tsx":i&&!s?n="with-auth.tsx":!i&&s&&(n="with-trpc.tsx");let o=b.join(a,n),r=b.join(e,"src/pages/_app.tsx");W.copySync(o,r)},Te=({projectDir:e,packages:t})=>{let a=b.join(p,"template/extras/src/app/layout"),s=t.tailwind.inUse,i=t.trpc.inUse,n="base.tsx";i&&s?n="with-trpc-tw.tsx":i&&!s?n="with-trpc.tsx":!i&&s&&(n="with-tw.tsx");let o=b.join(a,n),r=b.join(e,"src/app/layout.tsx");W.copySync(o,r)},Ce=({projectDir:e,packages:t})=>{let a=b.join(p,"template/extras/src/pages/index"),s=t.trpc.inUse,i=t.tailwind.inUse,n=t.nextAuth.inUse,o="base.tsx";s&&i&&n?o="with-auth-trpc-tw.tsx":s&&!i&&n?o="with-auth-trpc.tsx":s&&i?o="with-trpc-tw.tsx":s&&!i?o="with-trpc.tsx":!s&&i&&(o="with-tw.tsx");let r=b.join(a,o),m=b.join(e,"src/pages/index.tsx");W.copySync(r,m)},Re=({projectDir:e,packages:t})=>{let a=b.join(p,"template/extras/src/app/page"),s=t.trpc.inUse,i=t.tailwind.inUse,n=t.nextAuth.inUse,o="base.tsx";s&&i&&n?o="with-auth-trpc-tw.tsx":s&&!i&&n?o="with-auth-trpc.tsx":s&&i?o="with-trpc-tw.tsx":s&&!i?o="with-trpc.tsx":!s&&i&&(o="with-tw.tsx");let r=b.join(a,o),m=b.join(e,"src/app/page.tsx");W.copySync(r,m)};var Oe=async({projectName:e,scopedAppName:t,packages:a,noInstall:s,appRouter:i,databaseProvider:n})=>{let o=x(),r=U.resolve(process.cwd(),e);if(await ze({projectName:e,projectDir:r,pkgManager:o,scopedAppName:t,noInstall:s,appRouter:i,databaseProvider:n}),Ie({projectName:e,scopedAppName:t,projectDir:r,pkgManager:o,packages:a,noInstall:s,appRouter:i,databaseProvider:n}),i?(De.copyFileSync(U.join(p,"template/extras/config/next-config-appdir.js"),U.join(r,"next.config.js")),Te({projectDir:r,packages:a}),Re({projectDir:r,packages:a})):(je({projectDir:r,packages:a}),Ce({projectDir:r,packages:a})),!a.tailwind.inUse){let m=U.join(p,"template/extras/src/index.module.css"),c=U.join(r,"src",i?"app":"pages","index.module.css");De.copyFileSync(m,c)}return r};import{execSync as se}from"child_process";import ee from"path";import*as te from"@clack/prompts";import E from"chalk";import{execa as M}from"execa";import Ue from"fs-extra";import dt from"ora";var ft=e=>{try{return se("git --version",{cwd:e}),!0}catch{return!1}},ne=e=>Ue.existsSync(ee.join(e,".git")),ie=async e=>{try{return await M("git",["rev-parse","--is-inside-work-tree"],{cwd:e,stdout:"ignore"}),!0}catch{return!1}},ut=()=>{let t=se("git --version").toString().trim().split(" ")[2],a=t?.split(".")[0],s=t?.split(".")[1];return{major:Number(a),minor:Number(s)}},gt=()=>se("git config --global init.defaultBranch || echo main").toString().trim(),Ee=async e=>{if(l.info("Initializing Git..."),!ft(e)){l.warn("Git is not installed. Skipping Git initialization.");return}let t=dt(`Creating a new git repo...
`).start(),a=ne(e),s=await ie(e),i=ee.parse(e).name;if(s&&a){if(t.stop(),!await te.confirm({message:`${E.redBright.bold("Warning:")} Git is already initialized in "${i}". Initializing a new git repository would delete the previous history. Would you like to continue anyways?`,initialValue:!1})){t.info("Skipping Git initialization.");return}Ue.removeSync(ee.join(e,".git"))}else if(s&&!a&&(t.stop(),!await te.confirm({message:`${E.redBright.bold("Warning:")} "${i}" is already in a git worktree. Would you still like to initialize a new git repository in this directory?`,initialValue:!1}))){t.info("Skipping Git initialization.");return}try{let n=gt(),{major:o,minor:r}=ut();o<2||o==2&&r<28?(await M("git",["init"],{cwd:e}),await M("git",["symbolic-ref","HEAD",`refs/heads/${n}`],{cwd:e})):await M("git",["init",`--initial-branch=${n}`],{cwd:e}),await M("git",["add","."],{cwd:e}),t.succeed(`${E.green("Successfully initialized and staged")} ${E.green.bold("git")}
`)}catch{t.fail(`${E.bold.red("Failed:")} could not initialize git. Update git to the latest version!
`)}};var Me=async({projectName:e=N,packages:t,appRouter:a,noInstall:s,projectDir:i,databaseProvider:n})=>{let o=x();l.info("Next steps:"),e!=="."&&l.info(`  cd ${e}`),s&&(o==="yarn"?l.info(`  ${o}`):l.info(`  ${o} install`)),["postgres","mysql"].includes(n)&&l.info("  ./start-database.sh"),(t?.prisma.inUse||t?.drizzle.inUse)&&(["npm","bun"].includes(o)?l.info(`  ${o} run db:push`):l.info(`  ${o} db:push`)),["npm","bun"].includes(o)?l.info(`  ${o} run dev`):l.info(`  ${o} dev`),!await ie(i)&&!ne(i)&&l.info("  git init"),l.info('  git commit -m "initial commit"'),a&&l.warn(`
Thank you for trying out the App Router option. If you encounter any issues, please open an issue!`),t?.drizzle.inUse&&l.warn(`
Thank you for trying out the new Drizzle option. If you encounter any issues, please open an issue!`,`
Note: We use the PlanetScale driver so that you can query your data in edge runtimes. If you want to use a different driver, you'll need to change it yourself.`)};import B from"fs";import ht from"path";function Ne(e,t,a){B.readdirSync(e).forEach(i=>{let n=ht.join(e,i);if(B.statSync(n).isDirectory())Ne(n,t,a);else{let r=B.readFileSync(n,"utf8").replace(new RegExp(t,"g"),a);B.writeFileSync(n,r,"utf8")}})}var Fe=(e,t)=>{let a=t.replace(/\*/g,"").replace(/[^\/]$/,"$&/");Ne(e,"~/",a)};import $e from"path";var qe=e=>{let a=L(e).split("/"),s=a[a.length-1];if(s==="."){let o=$e.resolve(process.cwd());s=$e.basename(o)}let i=a.findIndex(o=>o.startsWith("@"));a.findIndex(o=>o.startsWith("@"))!==-1&&(s=a.slice(i).join("/"));let n=a.filter(o=>!o.startsWith("@")).join("/");return[s,n]};import yt from"gradient-string";var wt={blue:"#add7ff",cyan:"#89ddff",green:"#5de4c7",magenta:"#fae4fc",red:"#d0679d",yellow:"#fffac2"},Ge=()=>{let e=yt(Object.values(wt)),t=x();(t==="yarn"||t==="pnpm")&&console.log(""),console.log(e.multiline(le))};import xt from"chalk";import{execa as Le}from"execa";import Ve from"ora";var ae=async(e,t,a)=>{let{onDataHandle:s,args:i=["install"],stdout:n="pipe"}=a,o=Ve(`Running ${t} install...`).start(),r=Le(t,i,{cwd:e,stdout:n});return await new Promise((m,c)=>{s&&r.stdout?.on("data",s(o)),r.on("error",f=>c(f)),r.on("close",()=>m())}),o},bt=async(e,t)=>{switch(e){case"npm":return await Le(e,["install"],{cwd:t,stderr:"inherit"}),null;case"pnpm":return ae(t,e,{onDataHandle:a=>s=>{let i=s.toString();i.includes("Progress")&&(a.text=i.includes("|")?i.split(" | ")[1]??"":i)}});case"yarn":return ae(t,e,{onDataHandle:a=>s=>{a.text=s.toString()}});case"bun":return ae(t,e,{stdout:"ignore"})}},Je=async({projectDir:e})=>{l.info("Installing dependencies...");let t=x();(await bt(t,e)??Ve()).succeed(xt.green(`Successfully installed dependencies!
`))};import{execSync as vt}from"child_process";import _t from"https";var We=e=>{let t=T();t.includes("beta")?(l.warn("  You are using a beta version of create-t3-app."),l.warn("  Please report any bugs you encounter.")):t.includes("next")?(l.warn("  You are running create-t3-app with the @next tag which is no longer maintained."),l.warn("  Please run the CLI with @latest instead.")):t!==e&&(l.warn("  You are using an outdated version of create-t3-app."),l.warn("  Your version:",t+".","Latest version in the npm registry:",e),l.warn("  Please run the CLI with @latest to get the latest updates.")),console.log("")};function St(){return new Promise((e,t)=>{_t.get("https://registry.npmjs.org/-/package/create-t3-app/dist-tags",a=>{if(a.statusCode===200){let s="";a.on("data",i=>s+=i),a.on("end",()=>{e(JSON.parse(s).latest)})}else t()}).on("error",()=>{t()})})}var Be=()=>St().catch(()=>{try{return vt("npm view create-t3-app version").toString().trim()}catch{return null}});var kt=async()=>{let e=await Be(),t=x();Ge(),e&&We(e);let{appName:a,packages:s,flags:{noGit:i,noInstall:n,importAlias:o,appRouter:r},databaseProvider:m}=await ke(),c=_e(s,m),[f,w]=qe(a),g=await Oe({projectName:w,scopedAppName:f,packages:c,databaseProvider:m,importAlias:o,noInstall:n,appRouter:r}),y=oe.readJSONSync(H.join(g,"package.json"));if(y.name=f,y.ct3aMetadata={initVersion:T()},t!=="bun"){let{stdout:P}=await Pt(t,["-v"],{cwd:g});y.packageManager=`${t}@${P.trim()}`}oe.writeJSONSync(H.join(g,"package.json"),y,{spaces:2}),o!=="~/"&&Fe(g,o),n||await Je({projectDir:g}),oe.renameSync(H.join(g,"_eslintrc.cjs"),H.join(g,".eslintrc.cjs")),i||await Ee(g),await Me({projectName:w,packages:c,appRouter:r,noInstall:n,projectDir:g,databaseProvider:m}),process.exit(0)};kt().catch(e=>{l.error("Aborting installation..."),e instanceof Error?l.error(e):(l.error("An unknown error has occurred. Please open an issue on github with the below:"),console.log(e)),process.exit(1)});
